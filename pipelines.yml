queue: 'Hosted Linux Preview'
steps:

- task: Docker@0
  inputs:
    action: 'Build an image'
    imageName: 'adopnodekubeb7b0.azurecr.io/adopnodekube:$(Build.BuildId)'

- task: Docker@0
  inputs:
    action: 'Push an image'
    azureSubscription: node-kube
    imageName: adopnodekubeb7b0.azurecr.io/adopnodekube:$(build.buildid)
    azureContainerRegistry: '{"loginServer":"adopnodekubeb7b0.azurecr.io"}'

- task: HelmDeploy@0
  inputs:
    command: init
    azureSubscription: node-kube
    kubernetesCluster: adopnodekube
    azureResourceGroup: adopnodekube8b6b

- task: HelmDeploy@0
  inputs:
    command: package
    chartPath: charts/sampleapp
    azureSubscription: node-kube
    kubernetesCluster: adopnodekube
    azureResourceGroup: adopnodekube8b6b

- task: HelmDeploy@0
  inputs:
    command: upgrade
    chartType: FilePath
    releaseName: azuredevops
    azureSubscription: node-kube
    kubernetesCluster: adopnodekube    
    azureResourceGroup: adopnodekube8b6b
    chartPath: $(build.artifactstagingdirectory)/sampleapp-v0.2.0.tgz
    arguments: --set image.repository=adopnodekubeb7b0.azurecr.io/adopnodekube --set image.tag=$(build.buildid)
    
    
